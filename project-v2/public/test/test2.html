<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
</body>
<script>
	function test() {
		/* SECTION 1 */
		//database "library"
		var request = indexedDB.open("library");

		request.onupgradeneeded = function() {
			// The database did not previously exist, so create object stores and indexes.
			var db = request.result;

			//books stored by ther "isbn" attribute
			var store = db.createObjectStore("books", {keyPath: "isbn"});

			//titleIndex looked up by books by title & enforces a uniqueness constraint
			var titleIndex = store.createIndex("by_title", "title", {unique: true});

			//authorIndex looked up by author
			var authorIndex = store.createIndex("by_author", "author");

			// Populate with initial data.
			store.put({title: "Quarry Memories", author: "Fred", isbn: 123456});
			store.put({title: "Water Buffaloes", author: "Fred", isbn: 234567});
			store.put({title: "Bedrock Nights", author: "Barney", isbn: 345678});
		};

		request.onsuccess = function() {
			//
			db = request.result;
		};

		/* SECTION 2 */
		/*
		var IDBTransaction = IDBDatabase.transaction(storeNames);
		var IDBTransaction = IDBDatabase.transaction(storeNames, mode);

		-storeNames : The names of object stores that are in the scope of the new transaction
		-mode : Optional. The types of access that can be performed in the transaction.
					 ex. readonly, readwrite, readwriteflush
		-return value : An IDBTransaction object
		*/

		//open a read/write db transaction, ready for adding the data
		var tx = db.transaction("books", "readwrite");
		var store = tx.objectStore("books");

		store.put({title: "Quarry Memories", author: "Fred", isbn: 123456});
		store.put({title: "Water Buffaloes", author: "Fred", isbn: 234567});
		store.put({title: "Bedrock Nights", author: "Barney", isbn: 345678});

		tx.oncomplete = function() {
			// All requests have succeeded and the transaction has committed.
		};


		/* SECTION 3 */

		var tx = db.transaction("books", "readonly");
		var store = tx.objectStore("books");
		var index = store.index("by_title");

		//find books by title which title is Bedrock Nights
		var request = index.get("Bedrock Nights");
		request.onsuccess = function() {
			var matching = request.result;
			if (matching !== undefined) {
				// A match was found.
				report(matching.isbn, matching.title, matching.author);
			} else {
				// No match was found.
				report(null);
			}
		};

		/* SECTION 4 */
		/*
		- openCursor() :  method of the IDBObjectStore interface returns an IDBRequest object,
		Used for "iterating" through an object store with a cursor.

		var request = ObjectStore.openCursor();
		var request = ObjectStore.openCursor(query);
		var request = ObjectStore.openCursor(query, direction);

		- query : A key or IDBKeyRange to be queried
		- direction : It tells the cursor what direction to travel.
									ex. next, nextunique, prev, prevunique
		*/

		var tx = db.transaction("books", "readonly");
		var store = tx.objectStore("books");
		var index = store.index("by_author");

		var request = index.openCursor(IDBKeyRange.only("Fred"));
		request.onsuccess = function() {
			var cursor = request.result;
			if (cursor) {
				// Called for each matching record.
				report(cursor.value.isbn, cursor.value.title, cursor.value.author);
				cursor.continue();
			} else {
				// No more matching records.
				report(null);
			}
		};


		var tx = db.transaction("books", "readwrite");
		var store = tx.objectStore("books");
		var request = store.put({title: "Water Buffaloes", author: "Slate", isbn: 987654});
		request.onerror = function(event) {
			// The uniqueness constraint of the "by_title" index failed.
			report(request.error);
			// Could call event.preventDefault() to prevent the transaction from aborting.
		};
		tx.onabort = function() {
			// Otherwise the transaction will automatically abort due the failed request.
			report(tx.error);
		};

		//db.close();// database connection closed when db is no longer needed

	}
	test();
</script>
</html>
